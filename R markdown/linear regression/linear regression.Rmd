---
title: "Linear Regression Example"
author: "Adam Caffrey"
date: "16/12/2020"
output: html_document
---

Estimate the sale price of a house from other stuff

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load Libraries and Data
```{r warning=F, message=F}
library(tidymodels)
library(tidyverse)
library(corrplot)
library(kableExtra)
data <- readr::read_csv('./Life Expectancy Data.csv')
```

## Data Exploration

The first step in model selecion is data exploration. First determine what data you have.
```{r}
glimpse(data)
```

```{r}
nombres <- names(data)
meanings <- c("")
```

We wish to estimate values for car price

```{r}
visdat::vis_miss(data)
```

```{r}
any(is.na(data))
```
```{r}
# correlation here
data %>% 
  select(where(is.numeric)) %>% 
  cor %>% 
  corrplot(type = "upper",
           order = "hclust",
           tl.col = "black",
           tl.srt = 90)
```

```{r}
data %>% 
  select(where(is.numeric)) %>% 
  chart.Correlation()
```

## Data Cleaning
```{r}
data <- select(data, -car_ID)
```

## Data splitting
```{r}
data_split <- initial_split(data, prop = 3/4)
data_train <- training(data_split)
data_test <- testing(data_split)
```

## Data Preprocessing Recipe
```{r}
reg_recipe <- 
  recipe(price ~ ., data = data_train) %>% 
  step_dummy(all_nominal())

```

## Data Model Selection

Linear models should be used when
pros and cons, packages available
```{r}
reg_model <- 
  linear_reg() %>% 
  set_engine("lm")
```

## Model Evaluation
```{r}
wf <- 
  workflow() %>% 
  add_recipe(reg_recipe) %>% 
  add_model(reg_model)
  
```

```{r}
fit <- fit(wf, data = data_train)
```

```{r}
pred <- fit %>% 
  predict(data_test)
  
```

